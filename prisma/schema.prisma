// Database connection configuration
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

generator dbml {
  provider = "prisma-dbml-generator"
}

// User authentication and basic information
model User {

  id                String    @id @default(cuid())
  email             String    @unique
  password          String?   // Nullable for OAuth users
  emailVerified     Boolean   @default(false)
  googleId          String?   @unique
  canResetPassword  Boolean   @default(false)
  profile           Profile?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}


  // Detailed user profile
  model Profile {
    id           String       @id @default(cuid())
    userId       String       @unique
    user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
    username     String?
    prayers      Prayer[]
    prayerTimings PrayerTimings?
    gender       Gender     
    latitude     Float
    longitude    Float
    givenName    String?
    familyName   String?
    picture      String?
    createdAt    DateTime     @default(now())
    updatedAt    DateTime     @updatedAt
  }


model PrayerTimings {
  id           String   @id @default(cuid())
  fajr         DateTime
  dhuhr        DateTime
  asr          DateTime
  maghrib      DateTime
  isha         DateTime
  sunrise      DateTime
  sunset       DateTime
  imsak        DateTime
  midnight     DateTime
  profile      Profile       @relation(fields: [profileId], references: [id], onDelete: Cascade)
  profileId    String        @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Prayer {
  id           String        @id @default(cuid())
  prayerType   PrayerType
  menStatus    MenPrayerStatus?  // Optional field for men's specific prayer statuses
  womenStatus  WomenPrayerStatus? // Optional field for women's specific prayer statuses
  performedAt  DateTime
  notes        String?
  profile      Profile       @relation(fields: [profileId], references: [id], onDelete: Cascade)
  profileId    String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  prayerTime   DateTime      // Tracks the prayer time
  notifiedAt   DateTime?     // Tracks when the user was notified

  // Indexes for query optimization
  @@index([prayerType])
  @@index([menStatus])
  @@index([womenStatus])
}

// Possible prayer completion statuses for MEN
enum MenPrayerStatus {
  TAKBEERE_E_ULA 
  SALATAL_JAMAAH 
  INDIVIDUAL_PRAYER
  MISSED
}

// Possible prayer completion statuses for WOMEN
enum WomenPrayerStatus {
  PRAYED_AT_TIME
  PRAYED_LATE
  PRAYED_TOO_LATE
  MISSED
}

// Gender options
enum Gender {
  MEN
  WOMEN
  OTHER
}

// Prayer types in Islamic religion
enum PrayerType {
  FAJR
  DHUHR
  ASR
  MAGHRIB
  ISHA
}


